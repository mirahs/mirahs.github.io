window.__require=function t(e,o,n){function r(c,s){if(!o[c]){if(!e[c]){var a=c.split("/");if(a=a[a.length-1],!e[a]){var h="function"==typeof __require&&__require;if(!s&&h)return h(a,!0);if(i)return i(a,!0);throw new Error("Cannot find module '"+c+"'")}c=a}var u=o[c]={exports:{}};e[c][0].call(u.exports,function(t){return r(e[c][1][t]||t)},u,u.exports,t,e,o,n)}return o[c].exports}for(var i="function"==typeof __require&&__require,c=0;c<n.length;c++)r(n[c]);return r}({Game:[function(t,e,o){"use strict";cc._RF.push(e,"a4237AyPWNHla9mkm8FeldU","Game");var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,n){var r,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(c=(i<3?r(c):i>3?r(e,o,c):r(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=t("./Grid"),s=cc._decorator,a=s.ccclass,h=s.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bgNode=null,e.rootNode=null,e.lblScoreNow=null,e.lblScoreBest=null,e.grids=[],e.gridsReversed=[],e._moving=!1,e._canTouchMove=!1,e._scoreNow=0,e}return r(e,t),e.prototype.onLoad=function(){this.init()},e.prototype.start=function(){var t=this;this.randGrid(),this.randGrid(),this.node.on(cc.Node.EventType.TOUCH_START,function(){return t._canTouchMove=!0},this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.game.canvas.focus()},e.prototype.onTouchMove=function(t){if(this._canTouchMove&&!this._moving){var e=t.getStartLocation(),o=t.getLocation().sub(e);if(Math.abs(o.x)>Math.abs(o.y)){if(Math.abs(o.x)<10)return;this._canTouchMove=!1,o.x>0?this.moveRight():this.moveLeft()}else{if(Math.abs(o.y)<10)return;this._canTouchMove=!1,o.y>0?this.moveUp():this.moveDown()}}},e.prototype.onKeyDown=function(t){this._moving||(t.keyCode==cc.macro.KEY.up?this.moveUp():t.keyCode==cc.macro.KEY.down?this.moveDown():t.keyCode==cc.macro.KEY.left?this.moveLeft():t.keyCode==cc.macro.KEY.right&&this.moveRight())},e.prototype.init=function(){var t,e=this.rootNode.children[0];e.active=!1;for(var o=0,n=0;n<4;n++){this.grids[n]=[];for(var r=0;r<4;r++){var i=cc.instantiate(e);i.parent=this.rootNode;var s=i.getComponent(c.default);s.init(this.bgNode.children[o].getPosition()),this.grids[n][r]=s,o++}}for(e.destroy(),n=0;n<4;n++)for(this.gridsReversed[n]=[],r=0;r<4;r++)this.gridsReversed[n][r]=this.grids[r][n];this._scoreBest=parseInt(null!==(t=cc.sys.localStorage.getItem("KEY_SCORE_BEST"))&&void 0!==t?t:"0"),this.showScore(),this.node.getChildByName("btnRestart").on("click",function(){return cc.game.restart()}),this.initPanelFailed()},e.prototype.initPanelFailed=function(){this._panelFailed=this.node.getChildByName("panelFailed"),this._panelFailed.active=!1,this._panelFailed.getChildByName("btnOk").on("click",function(){return cc.game.restart()})},e.prototype.moveUp=function(){var t=this;this.gridsReversed.forEach(function(e){return t.move(e.slice().reverse())}),this.onMoveAfter()},e.prototype.moveDown=function(){var t=this;this.gridsReversed.forEach(function(e){return t.move(e)}),this.onMoveAfter()},e.prototype.moveLeft=function(){var t=this;this.grids.forEach(function(e){return t.move(e.slice().reverse())}),this.onMoveAfter()},e.prototype.moveRight=function(){var t=this;this.grids.forEach(function(e){return t.move(e)}),this.onMoveAfter()},e.prototype.onMoveAfter=function(){var t=this;this._moving&&this.scheduleOnce(function(){t._moving=!1,t.randGrid(),t.checkFail()},.1)},e.prototype.move=function(t){for(var e=this,o=t.length-1,n=t[o].num,r=function(r){var c=t[r];if(!c.num)return"continue";var s=t[o],a=c.num;if(n)if(n==a)i._moving=!0,o-=1,n=0,c.stopTween(),cc.tween(c.node).to(.1,{x:s.pos.x,y:s.pos.y}).call(function(){e.addScore(2*a),s.num=2*a,c.reset(),cc.tween(s.node).to(.1*.4,{scale:1.1}).delay(.1*.2).to(.03,{scale:1}).start()}).start();else if(r+1==o)o=r,n=a;else{i._moving=!0,n=a;var h=t[o-=1];c.stopTween(),cc.tween(c.node).to(.1,{x:h.pos.x,y:h.pos.y}).call(function(){h.num=a,c.reset()}).start()}else i._moving=!0,n=a,c.stopTween(),cc.tween(c.node).to(.1,{x:s.pos.x,y:s.pos.y}).call(function(){s.num=a,c.reset()}).start()},i=this,c=t.length-2;c>=0;c--)r(c)},e.prototype.randGrid=function(){for(var t=[],e=0,o=this.grids;e<o.length;e++)for(var n=0,r=o[e];n<r.length;n++){var i=r[n];i.num||t.push(i)}var c=t[this.randRange(0,t.length-1)];c.num=2,c.node.scale=0,cc.tween(c.node).to(.1,{scale:1}).start()},e.prototype.checkFail=function(){for(var t=this,e=0,o=[this.grids,this.gridsReversed];e<o.length;e++)for(var n=0,r=o[e];n<r.length;n++)for(var i=r[n],c=1;c<i.length;c++)if(!i[c].num||!i[c-1].num||i[c].num==i[c-1].num)return;this._moving=!0,this.scheduleOnce(function(){return t._panelFailed.active=!0},1)},e.prototype.addScore=function(t){this._scoreNow+=t,this._scoreNow>this._scoreBest&&(this._scoreBest=this._scoreNow,cc.sys.localStorage.setItem("KEY_SCORE_BEST",JSON.stringify(this._scoreBest))),this.showScore()},e.prototype.showScore=function(){this.lblScoreNow.string=this._scoreNow.toString(),this.lblScoreBest.string=this._scoreBest.toString()},e.prototype.randRange=function(t,e){return Math.round(Math.random()*(e-t)+t)},i([h(cc.Node)],e.prototype,"bgNode",void 0),i([h(cc.Node)],e.prototype,"rootNode",void 0),i([h(cc.Label)],e.prototype,"lblScoreNow",void 0),i([h(cc.Label)],e.prototype,"lblScoreBest",void 0),i([a],e)}(cc.Component);o.default=u,cc._RF.pop()},{"./Grid":"Grid"}],Grid:[function(t,e,o){"use strict";cc._RF.push(e,"acfe9tlnJlKbLtVsMjoSLlj","Grid");var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,n){var r,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(c=(i<3?r(c):i>3?r(e,o,c):r(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=cc._decorator.ccclass,s=["#ECE0D5","#EBDCC2","#F4A873","#F18151","#F1654D","#F0462D","#9A8032","#F4CD50","#78C93A","#C9963A","#C2BC2F","#E64AA4","#37C377","#0CF694","#35B8B5","#984DD9"],a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._num=0,e}return r(e,t),Object.defineProperty(e.prototype,"num",{get:function(){return this._num},set:function(t){this._num=t,this.lblNum.string=t.toString(),this.setColor()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pos",{get:function(){return this._pos},enumerable:!1,configurable:!0}),e.prototype.init=function(t){this.lblNum=this.node.getComponentInChildren(cc.Label),this._pos=t,this.node.active=!1,this.node.setPosition(t)},e.prototype.reset=function(){this._num=0,this.node.active=!1,this.node.setPosition(this._pos)},e.prototype.stopTween=function(){this.node.stopAllActions(),this.node.scale=1},e.prototype.setColor=function(){this.node.active||(this.node.active=!0),this.lblNum.node.color=this._num<=4?cc.Color.BLACK:cc.Color.WHITE;var t=Math.log2(this._num);t=t==s.length?s.length-1:t-1,this.node.color=(new cc.Color).fromHEX(s[t])},i([c],e)}(cc.Component);o.default=a,cc._RF.pop()},{}]},{},["Game","Grid"]);