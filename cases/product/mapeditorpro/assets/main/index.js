window.__require=function t(e,n,i){function o(r,s){if(!n[r]){if(!e[r]){var c=r.split("/");if(c=c[c.length-1],!e[c]){var l="function"==typeof __require&&__require;if(!s&&l)return l(c,!0);if(a)return a(c,!0);throw new Error("Cannot find module '"+r+"'")}r=c}var u=n[r]={exports:{}};e[r][0].call(u.exports,function(t){return o(e[r][1][t]||t)},u,u.exports,t,e,n,i)}return n[r].exports}for(var a="function"==typeof __require&&__require,r=0;r<i.length;r++)o(i[r]);return o}({AStar:[function(t,e,n){"use strict";cc._RF.push(e,"79a3agVAY1CiKPVtXatrQvo","AStar"),Object.defineProperty(n,"__esModule",{value:!0});var i=function(t,e,n){this.x=t,this.y=e,this.type=n,this.g=0},o=function(){function t(t,e,n,i){this.rows=t,this.cols=e,this.dir8=n,this.initData(i)}return t.prototype.findPath=function(t,e){if(!this.walkable(t.x,t.y)||!this.walkable(e.x,e.y))return[];for(var n=new i(t.x,t.y),o=new i(e.x,e.y),a=[n],r=[];a.length>0;){var s=a.shift();if(r.push(s),s.x==o.x&&s.y==o.y){var c=this.generatePath(s);return this.reset(),c}for(var l=-1;l<=1;l++)for(var u=-1;u<=1;u++)if(0!=l||0!=u){var p=s.x+l,h=s.y+u;if(!(p<0||p>=this.rows||h<0||h>=this.cols)){var f=this.grids[h][p];if(0!=f.type&&!r.includes(f)){if(this.dir8){if(0==this.grids[h][p-l].type||0==this.grids[h-u][p].type)continue}else if(Math.abs(l)==Math.abs(u))continue;this.setGrid(s,f,o),a.includes(f)||a.push(f)}}}a.sort(function(t,e){return t.f-e.f})}return this.reset(),[]},t.prototype.initData=function(t){this.grids=[];for(var e=0;e<this.cols;e++){this.grids[e]=[];for(var n=0;n<this.rows;n++)this.grids[e][n]=new i(n,e,t[e][n])}},t.prototype.walkable=function(t,e){return!(t<0||t>=this.rows||e<0||e>=this.cols)&&0!=this.grids[e][t].type},t.prototype.setGrid=function(t,e,n){var i=t.x==e.x||t.y==e.y?10:14,o=t.g+i;(0==e.g||e.g>o)&&(e.g=o,e.parent=t),e.h=this.dianonal(e.x,e.y,n),e.f=e.g+e.h},t.prototype.dianonal=function(t,e,n){return Math.abs(n.x-t)+Math.abs(n.y-e)},t.prototype.generatePath=function(t){var e=[];for(e.push(cc.v2(t.x,t.y));t.parent;)t=t.parent,e.push(cc.v2(t.x,t.y));return e.reverse()},t.prototype.reset=function(){for(var t=0;t<this.cols;t++)for(var e=0;e<this.rows;e++){var n=this.grids[t][e];n.g=0,n.h=0,n.f=0,n.parent=null}},t}();n.default=o,cc._RF.pop()},{}],AppConstants:[function(t,e,n){"use strict";cc._RF.push(e,"3bd65dH+mFBAqVT4to/3nqE","AppConstants"),Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){}return t.viewLayer={UI:100,Panel:200,Top:900},t.uiShowStyle={Normal:1,FadeIn:2},t.panelShowStyle={Normal:1,CenterSmallToBig:2,UpToCenter:3,DownToCenter:4,LeftToCenter:5,RightToCenter:6,Custom:7},t.panelMaskStyle={NoThrough:1,Black:2,Close:4},t.event={PanelShow:"PanelShow",PanelHide:"PanelHide"},t}();n.default=i,cc._RF.pop()},{}],AppUtil:[function(t,e,n){"use strict";cc._RF.push(e,"175adJDhVlPrbq38ciVatV6","AppUtil");var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,a){function r(t){try{c(i.next(t))}catch(e){a(e)}}function s(t){try{c(i.throw(t))}catch(e){a(e)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(r,s)}c((i=i.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,i,o,a,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(t){return function(e){return c([t,e])}}function c(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=2&a[0]?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,i=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(o=(o=r.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(s){a=[6,s],i=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(){}return t.setWidget=function(t,e,n,i,o,a){if(void 0===e&&(e=null),void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===a&&(a=0),!t.getComponent(cc.Widget)){var r=t.addComponent(cc.Widget);e&&(r.target=e),r.isAlignTop=!0,r.isAlignBottom=!0,r.isAlignLeft=!0,r.isAlignRight=!0,r.top=n,r.bottom=i,r.left=o,r.right=a}},t.asyncWrap=function(t){return i(this,void 0,Promise,function(){return o(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,t];case 1:return[2,[e.sent(),null]];case 2:return[2,[null,e.sent()]];case 3:return[2]}})})},t.newSpriteNode=function(t){void 0===t&&(t="newSpriteNode");var e=Uint8Array.from([255,255,255,255]),n=new cc.Texture2D;n.initWithData(e,cc.Texture2D.PixelFormat.RGBA8888,1,1);var i=new cc.SpriteFrame;i.setTexture(n);var o=new cc.Node(t),a=o.addComponent(cc.Sprite);return a.sizeMode=cc.Sprite.SizeMode.CUSTOM,a.spriteFrame=i,o.setContentSize(100,100),o},t.storeSet=function(t,e){cc.sys.localStorage.setItem(t,JSON.stringify(e))},t.getClassName=function(t){return(new t).getClassName()},t}();n.default=a,cc._RF.pop()},{}],App:[function(t,e,n){"use strict";cc._RF.push(e,"063f9YA5kFH54H4QH/DDyxe","App"),Object.defineProperty(n,"__esModule",{value:!0});var i=t("./view/LayerMgr"),o=t("./view/PanelMgr"),a=t("./view/UIMgr"),r=function(){function t(){}return t.init=function(t,e){t&&(this._uiMain=t),e&&(this._viewGroup=e),this.initFramework()},t.onSceneLoaded=function(){this.initFramework()},t.showNode=function(t,e,n,i){var o=this;void 0===e&&(e=""),void 0===n&&(n=0),void 0===i&&(i=4),console.log(e+t.name+":"+t.zIndex+":"+t.active),t.childrenCount<=0||++n>=i||t.children.forEach(function(t){return o.showNode(t,e+"\t",n,i)})},t.initFramework=function(){i.default.init(this._viewGroup),a.default.init(this._uiMain),o.default.init()},t._uiMain="UIMain",t._viewGroup="default",t}();n.default=r,cc._RF.pop()},{"./view/LayerMgr":"LayerMgr","./view/PanelMgr":"PanelMgr","./view/UIMgr":"UIMgr"}],AudioMgr:[function(t,e,n){"use strict";cc._RF.push(e,"8f41dcnwL1IK5sMIMShmWqw","AudioMgr");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var a=t("../AppUtil"),r=t("../base/Singleton"),s="app_volume_music",c="app_volume_effect",l="app_enable_music",u="app_enable_effect",p=function(t){function e(){var e=t.call(this)||this;e.musicVolume=1,e.effectVolume=1,e.musicEnable=!0,e.effectEnable=!0,(n=cc.sys.localStorage.getItem(s))&&(e.musicVolume=parseFloat(n)),(n=cc.sys.localStorage.getItem(c))&&(e.effectVolume=parseFloat(n));var n=cc.sys.localStorage.getItem(l);return e.musicEnable="false"!=n,!e.musicEnable&&cc.audioEngine.setMusicVolume(0),n=cc.sys.localStorage.getItem(u),e.effectEnable="false"!=n,!e.effectEnable&&cc.audioEngine.setEffectsVolume(0),cc.game.on(cc.game.EVENT_HIDE,e.pauseAll),cc.game.on(cc.game.EVENT_SHOW,e.resumeAll),e}return o(e,t),Object.defineProperty(e,"inst",{get:function(){return t.getInstance.call(this)},enumerable:!1,configurable:!0}),e.prototype.playMusic=function(t){this.stopMusic(),cc.audioEngine.playMusic(t,!0)},e.prototype.stopMusic=function(){cc.audioEngine.stopMusic()},e.prototype.playEffect=function(t,e){var n=cc.audioEngine.playEffect(t,!1);return e&&cc.audioEngine.setFinishCallback(n,e),n},e.prototype.stopEffect=function(t){cc.audioEngine.stopEffect(t)},e.prototype.getEffectDuration=function(t){return cc.audioEngine.getDuration(t)},e.prototype.getMusicVolume=function(){return this.musicEnable?this.musicVolume:0},e.prototype.setMusicVolume=function(t,e){void 0===e&&(e=!1),(this.musicVolume!=t||e)&&(this.musicVolume=t,cc.audioEngine.setMusicVolume(t),cc.sys.localStorage.setItem(s,t))},e.prototype.getEffectVolume=function(){return this.effectVolume?this.musicVolume:0},e.prototype.setEffectVolume=function(t,e){void 0===e&&(e=!1),(this.effectVolume!=t||e)&&(this.effectVolume=t,cc.audioEngine.setEffectsVolume(t),cc.sys.localStorage.setItem(c,t))},e.prototype.toogleMusicFlag=function(){this.musicEnable=!this.musicEnable,this.musicEnable?cc.audioEngine.setMusicVolume(this.musicVolume):cc.audioEngine.setMusicVolume(0),a.default.storeSet(l,this.musicEnable)},e.prototype.getMusicFlag=function(){return this.musicEnable},e.prototype.toogleEffectFlag=function(){this.effectEnable=!this.effectEnable,this.effectEnable?cc.audioEngine.setEffectsVolume(this.effectVolume):cc.audioEngine.setEffectsVolume(0),a.default.storeSet(u,this.effectEnable)},e.prototype.getEffectFlag=function(){return this.effectEnable},e.prototype.pauseAll=function(){cc.audioEngine.pauseAll()},e.prototype.resumeAll=function(){cc.audioEngine.resumeAll()},e}(r.default);n.default=p,cc._RF.pop()},{"../AppUtil":"AppUtil","../base/Singleton":"Singleton"}],Core:[function(t,e,n){"use strict";cc._RF.push(e,"3adb9T+OwZA6YY8hnJdrLCu","Core");var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,a){function r(t){try{c(i.next(t))}catch(e){a(e)}}function s(t){try{c(i.throw(t))}catch(e){a(e)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(r,s)}c((i=i.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,i,o,a,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(t){return function(e){return c([t,e])}}function c(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=2&a[0]?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,i=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(o=(o=r.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(s){a=[6,s],i=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../../framework/scripts/manager/EventMgr"),r=t("../GameConstants"),s=t("./Tip"),c=t("./Wait"),l=function(){function t(){}return t.init=function(){return i(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return[4,s.default.init()];case 1:return t.sent()?[4,c.default.init()]:[2];case 2:return t.sent()?(a.default.emit(r.default.event.CoreLoadOk),[2]):[2]}})})},t}();n.default=l,cc._RF.pop()},{"../../framework/scripts/manager/EventMgr":"EventMgr","../GameConstants":"GameConstants","./Tip":"Tip","./Wait":"Wait"}],Editor:[function(t,e,n){"use strict";cc._RF.push(e,"a00867vcNpJobGFWhyrAu16","Editor");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var r=t("../../framework/scripts/App"),s=t("../../framework/scripts/AppUtil"),c=t("../../framework/scripts/view/PanelMgr"),l=t("../map/MapData"),u=t("../core/Core"),p=t("../util/HtmlUtil"),h=t("../util/MapUtil"),f=t("../view/PanelChoiceDraw"),d=t("../map/MapAction"),g=t("../map/MapInfo"),y=t("../view/PanelMapNew"),m=t("../view/PanelMapOpen"),w=t("../../framework/scripts/view/TopBlock"),v=t("../GameConstants"),_=t("../view/PanelSave"),M=t("../../framework/scripts/manager/TimerMgr"),b=cc._decorator.ccclass,P=function(t,e){this.prefab=t,this.parent=e},C=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._drawMap=new Map,e._gridMap=new Map,e._mouseLastDownTime=0,e._polygonPoints=[],e._saveKey="__map_data__",e._saveFlag=!1,e}return o(e,t),e.prototype.onLoad=function(){r.default.init(),u.default.init(),this.init()},e.prototype.start=function(){this.saveStart(),this.loadMap("load",g.default.mapData)},e.prototype.init=function(){this.initButton(),this.initMap(),this.initStatus()},e.prototype.initButton=function(){var t=this,e=this.node.getChildByName("top");e.getChildByName("btnNew").on("click",function(){c.default.show(y.default,function(e){t.saveClear(),g.default.mapFileName=e.mapFileName,g.default.dataFileName=e.dataFileName,g.default.width=e.width,g.default.height=e.height,g.default.gridWidth=e.gridWidth,g.default.gridHeight=e.gridHeight,g.default.isBigMap=e.isBigMap,g.default.mapSpriteFrame=e.spriteFrame,g.default.sliceSize=e.sliceSize,g.default.sliceRows=e.sliceRows,g.default.sliceCols=e.sliceCols,g.default.mapSpriteFrameMap=e.spriteFrameMap,t.loadMap("new")})}),e.getChildByName("btnOpen").on("click",function(){c.default.show(m.default,function(e){t.saveClear(),g.default.mapFileName=e.mapFileName,g.default.dataFileName=e.dataFileName,g.default.width=e.width,g.default.height=e.height,g.default.gridWidth=e.gridWidth,g.default.gridHeight=e.gridHeight,g.default.isBigMap=e.isBigMap,g.default.mapSpriteFrame=e.spriteFrame,g.default.sliceSize=e.sliceSize,g.default.sliceRows=e.sliceRows,g.default.sliceCols=e.sliceCols,g.default.mapSpriteFrameMap=e.spriteFrameMap,t.loadMap("open",e.mapData)})}),e.getChildByName("btnSave").on("click",function(){t.saveClear(),p.default.saveFile(g.default.dataFileName,t.mapGetData())}),e.getChildByName("btnRun").on("click",function(){w.default.show(),g.default.mapScale=t.nodeMap.scale,g.default.mapPos=t.nodeMap.position,g.default.mapData=t.mapGetData(),cc.director.loadScene("runner")});var n=e.getChildByName("radioAction").getComponent(cc.ToggleContainer);n.node.getChildByName(g.default.mouseAction).getComponent(cc.Toggle).isChecked=!0,n.checkEvents.push(this.newEventHandler(this.node,"Editor","onRadioAction"));var i=e.getChildByName("btnDrawType");i.children[0].getComponent(cc.Label).string=v.default.mapDrawTypes[g.default.drawType-1][0],i.on(cc.Node.EventType.TOUCH_START,function(){c.default.show(f.default,v.default.mapDrawTypes,function(t){var e=t+1;e!=g.default.drawType&&(g.default.drawType=e,i.children[0].getComponent(cc.Label).string=v.default.mapDrawTypes[t][0])})});var o=e.getChildByName("checkboxGrid").getComponent(cc.Toggle);o.isChecked=g.default.isShowGrid,o.node.on("click",function(e){return t.graphicsGrid.node.active=g.default.isShowGrid=!e.isChecked});var a=e.getChildByName("checkboxPolygon").getComponent(cc.Toggle);a.isChecked=g.default.isShowPolygon,a.node.on("click",function(t){return g.default.isShowPolygon=!t.isChecked})},e.prototype.initMap=function(){this.nodeMap=this.node.getChildByName("middle").getChildByName("map"),g.default.isBigMap||g.default.mapSpriteFrame||(g.default.mapSpriteFrame=this.nodeMap.getComponent(cc.Sprite).spriteFrame),this.nodeMap.on(cc.Node.EventType.TOUCH_START,this.onMapTouchStart,this),this.nodeMap.on(cc.Node.EventType.TOUCH_MOVE,this.onMapTouchMove,this),this.nodeMap.on(cc.Node.EventType.MOUSE_WHEEL,this.onMapMouseWheel,this),this.nodeMap.on(cc.Node.EventType.MOUSE_DOWN,this.onMapMouseDown,this)},e.prototype.initStatus=function(){var t=this.node.getChildByName("bottom");this.lblMap=t.getChildByName("lblMap").getComponent(cc.Label),this.lblScale=t.getChildByName("lblScale").getComponent(cc.Label),this.lblPos=t.getChildByName("lblPos").getComponent(cc.Label),this.lblGrid=t.getChildByName("lblGrid").getComponent(cc.Label)},e.prototype.initDrawData=function(){var t;this._drawMap.clear(),this._gridMap.clear();for(var e=0;e<v.default.mapDrawTypes.length;e++){var n=e+1,i=v.default.mapDrawTypes[e],o=n.toString(),a=i[1],r=s.default.newSpriteNode(o);r.setContentSize(g.default.gridWidth-2,g.default.gridHeight-2),r.color=(new cc.Color).fromHEX(a),r.opacity=Number(null!==(t=i[2])&&void 0!==t?t:"255");var c=new cc.Node;c.parent=this.nodeMap,c.setAnchorPoint(cc.Vec2.ZERO),this._drawMap.set(n,new P(r,c))}},e.prototype.initMapGridGraphics=function(){var t=new cc.Node;t.parent=this.nodeMap,t.setAnchorPoint(cc.Vec2.ZERO),this.graphicsGrid=t.addComponent(cc.Graphics),this.graphicsGrid.strokeColor=cc.Color.RED;for(var e=1;e<g.default.rows;e++)this.mapGridDrawCol(e);for(e=1;e<g.default.cols;e++)this.mapGridDrawRow(e);t.active=g.default.isShowGrid},e.prototype.initMapPloygonGraphics=function(){var t=new cc.Node;t.parent=this.nodeMap,t.setAnchorPoint(cc.Vec2.ZERO),this.graphicsPolygon=t.addComponent(cc.Graphics),this.graphicsPolygon.strokeColor=cc.Color.GREEN},e.prototype.loadMap=function(t,e){this.nodeMap.destroyAllChildren(),g.default.isBigMap?this.loadSliceMap():this.nodeMap.getComponent(cc.Sprite).spriteFrame=g.default.mapSpriteFrame,"load"==t&&g.default.mapPos?(this.nodeMap.scale=g.default.mapScale,this.nodeMap.setPosition(g.default.mapPos)):(this.nodeMap.scale=1,this.nodeMap.setPosition(cc.Vec2.ZERO)),this.initDrawData(),this.initMapPloygonGraphics(),g.default.width=this.nodeMap.width,g.default.height=this.nodeMap.height,g.default.rows=Math.ceil(g.default.width/g.default.gridWidth),g.default.cols=Math.ceil(g.default.height/g.default.gridHeight),this.initMapGridGraphics(),e&&this.loadMapData(e),this.statusShow()},e.prototype.loadSliceMap=function(){this.nodeMap.getComponent(cc.Sprite).destroy(),this.nodeMap.width=g.default.width,this.nodeMap.height=g.default.height;for(var t=0;t<g.default.sliceCols;t++)for(var e=0;e<g.default.sliceRows;e++){var n=t+"_"+e,i=g.default.mapSpriteFrameMap.get(n),o=new cc.Node;o.addComponent(cc.Sprite).spriteFrame=i,o.parent=this.nodeMap,o.setPosition(h.default.sliceGridToPos(e,t))}},e.prototype.loadMapData=function(t){for(var e=0;e<t.cols;e++)for(var n=0;n<t.rows;n++){var i=t.data[e][n],o=this._drawMap.get(i);if(o){var a=cc.instantiate(o.prefab);a.name=""+i,a.parent=o.parent,a.setPosition(h.default.gridToPos(n,e));var r=h.default.xyToGridText(n,e);this._gridMap.set(r,a)}}},e.prototype.onMapTouchStart=function(t){this.mapTouch(t,!0)},e.prototype.onMapTouchMove=function(t){this.mapTouch(t)},e.prototype.onMapMouseWheel=function(t){var e=this.nodeMap.scale,n=this.nodeMap.getPosition(),i=this.nodeMap.parent.convertToNodeSpaceAR(t.getLocation()),o=this.nodeMap.getPosition().sub(i),a=e;a+=t.getScrollY()>0?.1:-.1,o.mulSelf(a/e);var r=i.add(o);this.nodeMap.scale=a,this.nodeMap.setPosition(r),this.mapCheckBoundary(r.x,r.y)||(this.nodeMap.scale=e,this.nodeMap.setPosition(n)),this.statusShowScale()},e.prototype.onMapMouseDown=function(t){if(g.default.isShowPolygon&&g.default.mouseAction!=d.default.Move){0==this._polygonPoints.length&&this.mapPolygonClearGraphics();var e=this.nodeMap.convertToNodeSpaceAR(t.getLocation()),n=(new Date).getTime();n-this._mouseLastDownTime<300?(this.mapPolygonWork(),this.mapPolygonClear()):(this._mouseLastDownTime=n,this._polygonPoints.push(e),this.mapPolygonDrawCircle(e))}},e.prototype.mapTouch=function(t,e){var n=this.nodeMap.convertToNodeSpaceAR(t.getLocation());if(this.statusShowPosGrid(n),!g.default.isShowPolygon||g.default.mouseAction==d.default.Move)if(e&&this.mapPolygonClearGraphics(),g.default.mouseAction==d.default.Move){var i=t.getDelta();this.mapActionMove(i)}else g.default.mouseAction==d.default.Draw?this.mapActionDraw(n):g.default.mouseAction==d.default.Clear&&this.mapActionClear(n)},e.prototype.mapActionMove=function(t){var e=t.x,n=t.y,i=this.nodeMap.x+e,o=this.nodeMap.y+n;this.nodeMap.setPosition(this.mapFixBoundary(i,o))},e.prototype.mapActionDraw=function(t){var e=h.default.pixelToGridText(t),n=this._drawMap.get(g.default.drawType),i=this._gridMap.get(e);i&&i.name==n.prefab.name||(i&&i.destroy(),(i=cc.instantiate(n.prefab)).parent=n.parent,i.setPosition(h.default.pixelToPos(t)),this._gridMap.set(e,i),this.saveSet())},e.prototype.mapActionClear=function(t){var e=h.default.pixelToGridText(t),n=this._gridMap.get(e);n&&(n.destroy(),this._gridMap.delete(e),this.saveSet())},e.prototype.mapGridDrawRow=function(t){this.graphicsGrid.moveTo(0,t*g.default.gridHeight),this.graphicsGrid.lineTo(this.nodeMap.width,t*g.default.gridHeight),this.graphicsGrid.stroke()},e.prototype.mapGridDrawCol=function(t){this.graphicsGrid.moveTo(t*g.default.gridWidth,0),this.graphicsGrid.lineTo(t*g.default.gridWidth,this.nodeMap.height),this.graphicsGrid.stroke()},e.prototype.mapPolygonDrawCircle=function(t){if(this.graphicsPolygon.lineWidth=10,this.graphicsPolygon.circle(t.x,t.y,1),this.graphicsPolygon.stroke(),this._polygonPoints.length>=2){var e=this._polygonPoints[this._polygonPoints.length-2];this.mapPolygonDrawLine(t,e)}},e.prototype.mapPolygonDrawLine=function(t,e){this.graphicsPolygon.lineWidth=5,this.graphicsPolygon.moveTo(t.x,t.y),this.graphicsPolygon.lineTo(e.x,e.y),this.graphicsPolygon.stroke()},e.prototype.mapPolygonWork=function(){if(!(this._polygonPoints.length<3)){this.mapPolygonDrawLine(this._polygonPoints[0],this._polygonPoints[this._polygonPoints.length-1]);for(var t=this._polygonPoints[0],e=t.x,n=t.x,i=t.y,o=t.y,a=0,r=this._polygonPoints;a<r.length;a++){var s=r[a];s.x<e&&(e=s.x),s.x>n&&(n=s.x),s.y<i&&(i=s.y),s.y>o&&(o=s.y)}for(var c=h.default.pixelToGrid(cc.v2(e,i)),l=h.default.pixelToGrid(cc.v2(n,o)),u=c.x;u<=l.x;u++)for(var p=c.y;p<=l.y;p++){var f=h.default.gridToPos(u,p);cc.Intersection.pointInPolygon(f,this._polygonPoints)&&(g.default.mouseAction==d.default.Draw?this.mapActionDraw(f):g.default.mouseAction==d.default.Clear&&this.mapActionClear(f))}}},e.prototype.mapPolygonClear=function(){this._mouseLastDownTime=0,this._polygonPoints=[]},e.prototype.mapPolygonClearGraphics=function(){this.mapPolygonClear(),this.graphicsPolygon.clear()},e.prototype.mapGetData=function(){var t=new l.default;t.map_file=g.default.mapFileName,t.width=this.nodeMap.width,t.height=this.nodeMap.height,t.grid_width=g.default.gridWidth,t.grid_height=g.default.gridHeight,t.rows=g.default.rows,t.cols=g.default.cols;for(var e=[],n=0;n<t.cols;n++){e[n]=[];for(var i=0;i<t.rows;i++){var o=0,a=h.default.xyToGridText(i,n),r=this._gridMap.get(a);r&&(o=parseInt(r.name)),e[n][i]=o}}return t.data=e,t},e.prototype.mapFixBoundary=function(t,e){var n=this.nodeMap.scale;return t<-this.nodeMap.width*n+this.nodeMap.parent.width&&(t=-this.nodeMap.width*n+this.nodeMap.parent.width),t>0&&(t=0),e<-this.nodeMap.height*n+this.nodeMap.parent.height&&(e=-this.nodeMap.height*n+this.nodeMap.parent.height),e>0&&(e=0),cc.v2(t,e)},e.prototype.mapCheckBoundary=function(t,e){var n=this.nodeMap.scale;return t>=-this.nodeMap.width*n+this.nodeMap.parent.width&&t<=0&&e>=-this.nodeMap.height*n+this.nodeMap.parent.height&&e<=0},e.prototype.statusShow=function(){this.statusShowMap(),this.statusShowScale(),this.statusShowPosGrid()},e.prototype.statusShowMap=function(){this.lblMap.string="\u5730\u56fe\uff1a"+g.default.mapFileName+", "+g.default.width+"x"+g.default.height+", "+g.default.gridWidth+"x"+g.default.gridHeight+", "+g.default.rows+"x"+g.default.cols},e.prototype.statusShowScale=function(){var t=this.nodeMap.scale.toString().slice(0,3);this.lblScale.string="\u7f29\u653e: "+t},e.prototype.statusShowPosGrid=function(t){void 0===t&&(t=cc.Vec2.ZERO);var e=h.default.pixelToGrid(t);this.lblPos.string="\u5750\u6807\uff1a"+Math.floor(t.x)+"x"+Math.floor(t.y),this.lblGrid.string="\u7f51\u683c\uff1a"+e.x+"x"+e.y},e.prototype.onRadioAction=function(t){g.default.mouseAction=t.node.name},e.prototype.newEventHandler=function(t,e,n){var i=new cc.Component.EventHandler;return i.target=t,i.component=e,i.handler=n,i},e.prototype.saveStart=function(){var t=this,e=cc.sys.localStorage.getItem(this._saveKey);e&&c.default.show(_.default,function(n){n&&p.default.saveFile(g.default.dataFileName,e,!1),t.saveClear()}),M.default.inst.add(1e3,this.saveDo,this,0)},e.prototype.saveSet=function(){null!=g.default.isBigMap&&(this._saveFlag=!0)},e.prototype.saveDo=function(){this._saveFlag&&cc.sys.localStorage.setItem(this._saveKey,JSON.stringify(this.mapGetData()))},e.prototype.saveClear=function(){this._saveFlag=!1,cc.sys.localStorage.removeItem(this._saveKey)},a([b],e)}(cc.Component);n.default=C,cc._RF.pop()},{"../../framework/scripts/App":"App","../../framework/scripts/AppUtil":"AppUtil","../../framework/scripts/manager/TimerMgr":"TimerMgr","../../framework/scripts/view/PanelMgr":"PanelMgr","../../framework/scripts/view/TopBlock":"TopBlock","../GameConstants":"GameConstants","../core/Core":"Core","../map/MapAction":"MapAction","../map/MapData":"MapData","../map/MapInfo":"MapInfo","../util/HtmlUtil":"HtmlUtil","../util/MapUtil":"MapUtil","../view/PanelChoiceDraw":"PanelChoiceDraw","../view/PanelMapNew":"PanelMapNew","../view/PanelMapOpen":"PanelMapOpen","../view/PanelSave":"PanelSave"}],EventMgr:[function(t,e,n){"use strict";cc._RF.push(e,"c2779N8KfFKKqQ1YKrcicli","EventMgr"),Object.defineProperty(n,"__esModule",{value:!0});var i=t("../AppConstants"),o=function(){function t(){}return t.on=function(t,e,n){this._events.has(t)?this._events.get(t).push({cb:e,ctx:n}):this._events.set(t,[{cb:e,ctx:n}])},t.off=function(t,e,n){if(this._events.has(t)){var i=this._events.get(t).findIndex(function(t){return e===t.cb&&t.ctx===n});i>=0&&this._events.get(t).splice(i,1)}else console.error("EventMgr.off event["+t+"]\u672a\u6ce8\u518c")},t.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this._events.has(t)?this._events.get(t).forEach(function(t){var n=t.cb,i=t.ctx;n.apply(i,e)}):t!=i.default.event.PanelShow&&t!=i.default.event.PanelHide&&console.error("EventMgr.emit event["+t+"] \u672a\u6ce8\u518c")},t.clear=function(t){t&&this._events.forEach(function(e){for(var n=e.length-1;n>=0;n--)e[n].ctx==t&&e.splice(n,1)})},t._events=new Map,t}();n.default=o,cc._RF.pop()},{"../AppConstants":"AppConstants"}],FileUtil:[function(t,e,n){"use strict";cc._RF.push(e,"f303bCni5lMHIt9VMOkS+GN","FileUtil"),Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){}return t.getBasename=function(t){var e=t.lastIndexOf(".");return e<0?t:t.substring(0,e)},t.getExtname=function(t){var e=t.lastIndexOf(".");return e<0?"":t.substring(e+1)},t}();n.default=i,cc._RF.pop()},{}],GameConstants:[function(t,e,n){"use strict";cc._RF.push(e,"5b4b7pwYlRAv7o/dcoh2iqe","GameConstants"),Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){}return t.event={CoreLoadOk:"CoreLoadOk"},t.mapDrawTypes=[["\u53ef\u884c\u8d70","#FFFF00"],["\u534a\u900f\u660e","#FFFF00","100"]],t}();n.default=i,cc._RF.pop()},{}],HtmlUtil:[function(t,e,n){"use strict";cc._RF.push(e,"3e7a3jBdRhBlZyNggMlJuER","HtmlUtil"),Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){}return t.getInputFile=function(t,e,n){void 0===e&&(e="");var i=document.getElementById(t);return i||((i=document.createElement("input")).id=t,i.type="file",i.accept=e,i.style.display="none",n&&(i.onchange=n),document.body.appendChild(i),i)},t.saveFile=function(t,e,n){void 0===n&&(n=!0);var i=document.createElement("a");i.download=t,i.innerHTML="Save File",i.style.display="none";var o=n?JSON.stringify(e):e,a=new Blob([o]);i.href=window.URL.createObjectURL(a),i.onclick=function(){document.body.removeChild(i)},document.body.appendChild(i),i.click()},t.openLink=function(t){var e=document.createElement("a");e.setAttribute("href",t),e.setAttribute("target","_blank"),e.style.display="none",e.onclick=function(){document.body.removeChild(e)},document.body.appendChild(e),e.click()},t}();n.default=i,cc._RF.pop()},{}],HttpMgr:[function(t,e,n){"use strict";cc._RF.push(e,"6eed3IUL3ND8aQjyUSpQ7S1","HttpMgr"),Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){}return t.get=function(t,e,n){return this.request(t,"GET",e,n)},t.post=function(t,e,n){return this.request(t,"POST",e,n)},t.put=function(t,e,n){return this.request(t,"PUT",e,n)},t.patch=function(t,e,n){return this.request(t,"PATCH",e,n)},t.delete=function(t,e,n){return this.request(t,"DELETE",e,n)},t.request=function(t,e,n,i){var o=this;return new Promise(function(a,r){var s=cc.loader.getXMLHttpRequest();s.timeout=1e4,s.ontimeout=function(){r("\u8bf7\u6c42\u8d85\u65f6")},s.onerror=function(){r("onerror url:"+t+",statusText:"+s.statusText)},s.onreadystatechange=function(){if(4==s.readyState){var t=s.responseText;if(t)if(i)try{a(JSON.parse(t))}catch(e){r(e)}else a(t);else a(t)}};var c=o.args2HttpParams(n);"GET"==e?(t=""==c?t:t+"?"+c,s.open(e,t,!0),s.send()):(s.open(e,t,!0),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send(c))})},t.args2HttpParams=function(t){if(!t)return"";var e="";for(var n in t){var i=t[n];if(Array.isArray(i))for(var o=0,a=i;o<a.length;o++)e+=n+"="+a[o]+"&";else e+=n+"="+i+"&"}return e.substring(0,e.length-1)},t}();n.default=i,cc._RF.pop()},{}],LayerMgr:[function(t,e,n){"use strict";cc._RF.push(e,"be8d7jMIjtAsJ1enFzADBKk","LayerMgr"),Object.defineProperty(n,"__esModule",{value:!0});var i=t("../AppConstants"),o=t("../AppUtil"),a=function(){function t(){}return t.init=function(t){for(var e in this.viewGroup=t,this._layerMap.clear(),i.default.viewLayer){var n=i.default.viewLayer[e];this.newLayer(e,n)}},t.newLayer=function(t,e){var n=cc.Canvas.instance.node.getChildByName(t);n||((n=new cc.Node(t)).parent=cc.Canvas.instance.node,n.group=this.viewGroup,n.zIndex=e,o.default.setWidget(n),this._layerMap.set(e,n))},t.setLayer=function(t,e){var n=this._layerMap.get(e);n?(t.parent||(t.parent=n),t.zIndex=this._zIndex++):console.error("LayerMgr.setLayer layer["+e+"] \u4e0d\u5b58\u5728")},t._layerMap=new Map,t._zIndex=0,t}();n.default=a,cc._RF.pop()},{"../AppConstants":"AppConstants","../AppUtil":"AppUtil"}],MapAction:[function(t,e,n){"use strict";var i;cc._RF.push(e,"e86dfApHcJJCLPUyJW1dNxH","MapAction"),Object.defineProperty(n,"__esModule",{value:!0}),function(t){t.Move="move",t.Clear="clear",t.Draw="draw"}(i||(i={})),n.default=i,cc._RF.pop()},{}],MapArg:[function(t,e,n){"use strict";cc._RF.push(e,"01db3uC3oNHob2TQuVljpMO","MapArg"),Object.defineProperty(n,"__esModule",{value:!0});n.default=function(){},cc._RF.pop()},{}],MapData:[function(t,e,n){"use strict";cc._RF.push(e,"f06a09EZq9H1Jy/O3jv7OeJ","MapData"),Object.defineProperty(n,"__esModule",{value:!0});n.default=function(){},cc._RF.pop()},{}],MapInfo:[function(t,e,n){"use strict";cc._RF.push(e,"7a45cNYZwVBAoUl1NIZ1Sys","MapInfo"),Object.defineProperty(n,"__esModule",{value:!0});var i=t("./MapAction"),o=function(){function t(){}return t.mapFileName="map.jpg",t.dataFileName="map.json",t.gridWidth=40,t.gridHeight=40,t.mouseAction=i.default.Move,t.drawType=1,t.isShowPolygon=!1,t.isShowGrid=!0,t.mapScale=1,t}();n.default=o,cc._RF.pop()},{"./MapAction":"MapAction"}],MapUtil:[function(t,e,n){"use strict";cc._RF.push(e,"3c251CRF4xIopwMK5tL9tjs","MapUtil"),Object.defineProperty(n,"__esModule",{value:!0});var i=t("../map/MapInfo"),o=function(){function t(){}return t.pixelToGrid=function(t){var e=Math.floor(t.x/i.default.gridWidth),n=Math.floor(t.y/i.default.gridHeight);return cc.v2(e,n)},t.gridToPos=function(t,e){return cc.v2(t*i.default.gridWidth+i.default.gridWidth/2,e*i.default.gridHeight+i.default.gridHeight/2)},t.pixelToPos=function(t){var e=this.pixelToGrid(t);return this.gridToPos(e.x,e.y)},t.pixelToGridText=function(t){var e=this.pixelToGrid(t);return this.xyToGridText(e.x,e.y)},t.xyToGridText=function(t,e){return t+"_ "+e},t.sliceGridToPos=function(t,e){return cc.v2(t*i.default.sliceSize+i.default.sliceSize/2,e*i.default.sliceSize+i.default.sliceSize/2)},t}();n.default=o,cc._RF.pop()},{"../map/MapInfo":"MapInfo"}],MaskProgressComp:[function(t,e,n){"use strict";cc._RF.push(e,"89c2eXXzf9IibF9NrNmHD2a","MaskProgressComp");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0}),n.TextProgress=n.Direction=void 0;var r,s,c=cc._decorator,l=c.ccclass,u=c.property,p=c.menu;(function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"})(r=n.Direction||(n.Direction={})),function(t){t[t.TYPE1=0]="TYPE1",t[t.TYPE2=1]="TYPE2"}(s=n.TextProgress||(n.TextProgress={}));var h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.direction=r.HORIZONTAL,e.mask=null,e.lblProgress=null,e.textProgress=s.TYPE1,e.iconFolowed=null,e._progress=0,e}return o(e,t),Object.defineProperty(e.prototype,"progress",{get:function(){return this._progress},set:function(t){this._progress=t,this.direction==r.VERTICAL?(this.mask.height=Math.floor(t*this.node.height),this.iconFolowed&&(this.iconFolowed.y=this.mask.y+this.mask.height)):(this.mask.width=Math.floor(t*this.node.width),this.iconFolowed&&(this.iconFolowed.x=this.mask.x+this.mask.width)),this.lblProgress&&(this.textProgress==s.TYPE1?this.lblProgress.string="\u52a0\u8f7d\u4e2d... "+Math.round(100*t)+"%":this.lblProgress.string=Math.round(100*t)+"%")},enumerable:!1,configurable:!0}),e.prototype.setProgress=function(t){this._progressTween&&(this._progressTween.stop(),this._progress=null),this.progress=this.checkProgress(t)},e.prototype.updateProgress=function(t){this._progressTween&&this._progressTween.stop(),this._progressTween=cc.tween(this).to(1,{progress:this.checkProgress(t)}).start()},e.prototype.checkProgress=function(t){return t=Math.max(t,0),Math.min(t,1)},a([u({type:cc.Enum(r)})],e.prototype,"direction",void 0),a([u(cc.Node)],e.prototype,"mask",void 0),a([u(cc.Label)],e.prototype,"lblProgress",void 0),a([u({type:cc.Enum(s)})],e.prototype,"textProgress",void 0),a([u(cc.Node)],e.prototype,"iconFolowed",void 0),a([l,p("UI/MaskProgressComp")],e)}(cc.Component);n.default=h,cc._RF.pop()},{}],PanelBase:[function(t,e,n){"use strict";cc._RF.push(e,"c91eei7jz5E5KBWlfnVlcT8","PanelBase");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var a=t("../AppConstants"),r=t("./PanelMgr"),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.panelShowStyle=a.default.panelShowStyle.Normal,e.panelMaskStyle=a.default.panelMaskStyle.NoThrough,e.duration=.2,e.blackMaskDuration=.1,e}return o(e,t),e.prototype.close=function(){r.default.hide(this.panelName)},e.prototype.closeImmediate=function(){r.default.destroy(this.panelName)},e}(t("./ViewBase").default);n.default=s,cc._RF.pop()},{"../AppConstants":"AppConstants","./PanelMgr":"PanelMgr","./ViewBase":"ViewBase"}],PanelChoiceDraw:[function(t,e,n){"use strict";cc._RF.push(e,"591fdjncwhMsZzJg2c1Sa15","PanelChoiceDraw");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var a=t("../../framework/scripts/AppConstants"),r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bundleName="null",e.skinPath="_panels/PanelChoiceDraw",e.panelMaskStyle=a.default.panelMaskStyle.NoThrough|a.default.panelMaskStyle.Black,e}return o(e,t),e.prototype.onInitDone=function(){for(var t,e=this,n=this.skin.getChildByName("items").children[0],i=this._args[0],o=function(o){var a=i[o],r=a[0],s=a[1],c=cc.instantiate(n);c.name=r,c.color=(new cc.Color).fromHEX(s),c.opacity=Number(null!==(t=a[2])&&void 0!==t?t:"255"),c.children[0].getComponent(cc.Label).string=r,c.parent=n.parent,c.on(cc.Node.EventType.TOUCH_START,function(){e._args[1](o),e.close()})},a=0;a<i.length;a++)o(a);n.destroy()},e}(t("../../framework/scripts/view/PanelBase").default);n.default=r,cc._RF.pop()},{"../../framework/scripts/AppConstants":"AppConstants","../../framework/scripts/view/PanelBase":"PanelBase"}],PanelMapNew:[function(t,e,n){"use strict";cc._RF.push(e,"32679M4TCNCTYTZZMxWL1r6","PanelMapNew");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,a){function r(t){try{c(i.next(t))}catch(e){a(e)}}function s(t){try{c(i.throw(t))}catch(e){a(e)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(r,s)}c((i=i.apply(t,e||[])).next())})},r=this&&this.__generator||function(t,e){var n,i,o,a,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(t){return function(e){return c([t,e])}}function c(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=2&a[0]?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,i=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(o=(o=r.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(s){a=[6,s],i=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var s=t("../../framework/scripts/AppConstants"),c=t("../../framework/scripts/view/PanelBase"),l=t("../core/Tip"),u=t("../core/Wait"),p=t("../map/MapArg"),h=t("../util/FileUtil"),f=t("../util/HtmlUtil"),d=t("../util/TimeUtil"),g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bundleName="null",e.skinPath="_panels/PanelMapNew",e.panelMaskStyle=s.default.panelMaskStyle.NoThrough|s.default.panelMaskStyle.Black,e}return o(e,t),e.prototype.onInitDone=function(){var t=this;this.checkBoxBigMap=this.skin.getChildByName("checkBoxBigMap").getComponent(cc.Toggle),this.checkBoxBigMap.node.on("click",function(e){t.fileMapInput.value="",t.lblMapFile.string="";var n=(e.isChecked?"":".json,")+"image/jpeg,image/jpg,image/png";t.fileMapInput.accept=n,t.fileMapInput.multiple=!e.isChecked}),this.fileMapInput=f.default.getInputFile("mapEditor-file_map_new","image/jpeg,image/jpg,image/png"),this.fileMapInput.onchange=function(){t.checkBoxBigMap.isChecked?t.onBigMapInputChange():t.lblMapFile.string=t.fileMapInput.files[0].name},this.lblMapFile=this.skin.getChildByName("spriteMapFile").getChildByName("lblMapFile").getComponent(cc.Label)},e.prototype.onButtonClick=function(t){"BtnOpenFile"==t.name?this.fileMapInput.click():"BtnCancel"==t.name?this.close():"BtnConfirm"==t.name&&this.onClickBtnConfirm()},e.prototype.onDestroy=function(){this.fileMapInput.onchange=null,this.fileMapInput.value=""},e.prototype.onBigMapInputChange=function(){for(var t=0;t<this.fileMapInput.files.length;t++){var e=this.fileMapInput.files[t];if("slices.json"==e.name)return this.fileSlice=e,void(this.lblMapFile.string="slices.json")}this.fileSlice=null,this.fileMapInput.value="",this.lblMapFile.string="",l.default.show("slices.json \u6587\u4ef6\u4e0d\u5b58\u5728")},e.prototype.onClickBtnConfirm=function(){if(!this.checkBoxBigMap.isChecked&&this.fileMapInput.files.length<=0||this.checkBoxBigMap.isChecked&&this.fileMapInput.files.length<=1)l.default.show("\u8bf7\u9009\u62e9\u5730\u56fe\u6587\u4ef6");else{var t=this.skin.getChildByName("editGridWidth").getComponent(cc.EditBox),e=this.skin.getChildByName("editGridHeight").getComponent(cc.EditBox),n=t.string?Number(t.string):40,i=e.string?Number(e.string):40;if(n<30||n>100)l.default.show("\u7f51\u683c\u5bbd\u5ea6 [30, 100]");else if(i<30||i>100)l.default.show("\u7f51\u683c\u9ad8\u5ea6 [30, 100]");else{var o=new p.default;o.gridWidth=n,o.gridHeight=i,this.checkBoxBigMap.isChecked?this.loadSliceMap(o):this.loadMap(o)}}},e.prototype.loadMap=function(t){var e=this,n=new FileReader;n.onload=function(){var i=new Image;i.src=n.result,i.onload=function(){var n=new cc.Texture2D;n.initWithElement(i),t.isBigMap=!1,t.mapFileName=e.fileMapInput.files[0].name,t.dataFileName=h.default.getBasename(t.mapFileName)+".json",t.spriteFrame=new cc.SpriteFrame(n),e._args[0](t),e.close()}},n.readAsDataURL(this.fileMapInput.files[0])},e.prototype.loadSliceMap=function(t){var e=this;if(this.fileSlice){for(var n=new Map,i=0;i<this.fileMapInput.files.length;i++){var o=this.fileMapInput.files[i];n.set(o.name,o)}var s=new FileReader;s.onload=function(){return a(e,void 0,void 0,function(){var e,i,o,a,c,p,f,g,y,m=this;return r(this,function(w){switch(w.label){case 0:e=JSON.parse(s.result),t.isBigMap=!0,t.mapFileName=e.file,t.dataFileName=h.default.getBasename(t.mapFileName)+".json",t.width=e.width,t.height=e.height,t.sliceSize=e.size,t.sliceRows=e.rows,t.sliceCols=e.cols,i=h.default.getExtname(t.mapFileName),o=new Map,u.default.show(),a=t.sliceRows*t.sliceCols,c=0,p=0,f=function(e){var s,h,f;return r(this,function(g){switch(g.label){case 0:s=function(s){var h,f,g;return r(this,function(r){switch(r.label){case 0:return h=e+"_"+s+"."+i,(f=n.get(h))?((g=new FileReader).onload=function(){var n=new Image;n.src=g.result,n.onload=function(){p--;var i=new cc.Texture2D;i.initWithElement(n);var r=new cc.SpriteFrame(i);o.set(e+"_"+s,r),++c>=a&&(u.default.hide(),t.spriteFrameMap=o,m._args[0](t),m.close())}},g.readAsDataURL(f),++p>=5?[4,d.default.sleep(100)]:[3,2]):(u.default.hide(),l.default.show("\u5730\u56fe\u5207\u7247\u6587\u4ef6 ["+h+"] \u4e0d\u5b58\u5728"),[2,{value:void 0}]);case 1:r.sent(),r.label=2;case 2:return[2]}})},h=0,g.label=1;case 1:return h<t.sliceRows?[5,s(h)]:[3,4];case 2:if("object"==typeof(f=g.sent()))return[2,f];g.label=3;case 3:return h++,[3,1];case 4:return[2]}})},g=0,w.label=1;case 1:return g<t.sliceCols?[5,f(g)]:[3,4];case 2:if("object"==typeof(y=w.sent()))return[2,y.value];w.label=3;case 3:return g++,[3,1];case 4:return[2]}})})},s.readAsText(this.fileSlice)}else l.default.show("slices.json \u6587\u4ef6\u4e0d\u5b58\u5728")},e}(c.default);n.default=g,cc._RF.pop()},{"../../framework/scripts/AppConstants":"AppConstants","../../framework/scripts/view/PanelBase":"PanelBase","../core/Tip":"Tip","../core/Wait":"Wait","../map/MapArg":"MapArg","../util/FileUtil":"FileUtil","../util/HtmlUtil":"HtmlUtil","../util/TimeUtil":"TimeUtil"}],PanelMapOpen:[function(t,e,n){"use strict";cc._RF.push(e,"5c452ytq0pKH4d0YJNtQT6I","PanelMapOpen");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,a){function r(t){try{c(i.next(t))}catch(e){a(e)}}function s(t){try{c(i.throw(t))}catch(e){a(e)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(r,s)}c((i=i.apply(t,e||[])).next())})},r=this&&this.__generator||function(t,e){var n,i,o,a,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(t){return function(e){return c([t,e])}}function c(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=2&a[0]?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,i=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(o=(o=r.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(s){a=[6,s],i=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var s=t("../../framework/scripts/AppConstants"),c=t("../../framework/scripts/view/PanelBase"),l=t("../core/Tip"),u=t("../core/Wait"),p=t("../map/MapArg"),h=t("../util/FileUtil"),f=t("../util/HtmlUtil"),d=t("../util/TimeUtil"),g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bundleName="null",e.skinPath="_panels/PanelMapOpen",e.panelMaskStyle=s.default.panelMaskStyle.NoThrough|s.default.panelMaskStyle.Black,e}return o(e,t),e.prototype.onInitDone=function(){var t=this;this.checkBoxBigMap=this.skin.getChildByName("checkBoxBigMap").getComponent(cc.Toggle),this.checkBoxBigMap.node.on("click",function(e){t.fileMapInput.value="",t.lblMapFile.string="";var n=(e.isChecked?"":".json,")+"image/jpeg,image/jpg,image/png";t.fileMapInput.accept=n,t.fileMapInput.multiple=!e.isChecked}),this.fileMapInput=f.default.getInputFile("mapEditor-file_open_map","image/jpeg,image/jpg,image/png"),this.fileMapInput.onchange=function(){t.checkBoxBigMap.isChecked?t.onBigMapInputChange():t.lblMapFile.string=t.fileMapInput.files[0].name},this.lblMapFile=this.skin.getChildByName("spriteMapFile").getChildByName("lblMapFile").getComponent(cc.Label),this.fileDataInput=f.default.getInputFile("mapEditor-file_open_data",".json"),this.fileDataInput.onchange=function(){var e=t.fileDataInput.files;!e||e.length<=0||(t.fileData=e[0],t.lblDataFile.string=t.fileData.name)},this.lblDataFile=this.skin.getChildByName("spriteDataFile").getChildByName("lblDataFile").getComponent(cc.Label)},e.prototype.onButtonClick=function(t){"BtnOpenFile"==t.name?this.fileMapInput.click():"BtnOpenData"==t.name?this.fileDataInput.click():"BtnCancel"==t.name?this.close():"BtnConfirm"==t.name&&this.onClickBtnConfirm()},e.prototype.onDestroy=function(){this.fileMapInput.onchange=null,this.fileMapInput.value="",this.fileDataInput.onchange=null,this.fileDataInput.value=""},e.prototype.onBigMapInputChange=function(){for(var t=0;t<this.fileMapInput.files.length;t++){var e=this.fileMapInput.files[t];if("slices.json"==e.name)return this.fileSlice=e,void(this.lblMapFile.string="slices.json")}this.fileSlice=null,this.fileMapInput.value="",this.lblMapFile.string="",l.default.show("slices.json \u6587\u4ef6\u4e0d\u5b58\u5728")},e.prototype.onClickBtnConfirm=function(){var t=this;if(!this.checkBoxBigMap.isChecked&&this.fileMapInput.files.length<=0||this.checkBoxBigMap.isChecked&&this.fileMapInput.files.length<=1)l.default.show("\u8bf7\u9009\u62e9\u5730\u56fe\u6587\u4ef6");else if(this.fileData){var e=new FileReader;e.onload=function(){var n=JSON.parse(e.result),i=new p.default;i.mapFileName=n.map_file,i.dataFileName=h.default.getBasename(i.mapFileName)+".json",i.width=n.width,i.height=n.height,i.gridWidth=n.grid_width,i.gridHeight=n.grid_height,i.mapData=n,t.checkBoxBigMap.isChecked?t.loadSliceMap(i):t.loadMap(i)},e.readAsText(this.fileData)}else l.default.show("\u8bf7\u9009\u62e9\u6570\u636e\u6587\u4ef6")},e.prototype.loadMap=function(t){var e=this,n=new FileReader;n.onload=function(){var i=new Image;i.src=n.result,i.onload=function(){if(i.width==t.width&&i.height==t.height){var n=new cc.Texture2D;n.initWithElement(i),t.spriteFrame=new cc.SpriteFrame(n),e._args[0](t),e.close()}else cc.error("\u5730\u56fe\u6587\u4ef6 ["+e.fileMap.name+"] \u5bbd\u9ad8\u548c\u6570\u636e\u6587\u4ef6 ["+e.fileData.name+"] \u5bbd\u9ad8\u4e0d\u4e00\u81f4")}},n.readAsDataURL(this.fileMap)},e.prototype.loadSliceMap=function(t){var e=this;if(this.fileSlice){for(var n=new Map,i=0;i<this.fileMapInput.files.length;i++){var o=this.fileMapInput.files[i];n.set(o.name,o)}var s=new FileReader;s.onload=function(){return a(e,void 0,void 0,function(){var e,i,o,a,c,p,f,g,y,m=this;return r(this,function(w){switch(w.label){case 0:if((e=JSON.parse(s.result)).width!=t.width||e.height!=t.height)return cc.error("slice.json \u6587\u4ef6\u548c\u6570\u636e\u6587\u4ef6 ["+this.fileData.name+"] \u5bbd\u9ad8\u4e0d\u4e00\u81f4"),[2];t.isBigMap=!0,t.sliceSize=e.size,t.sliceRows=e.rows,t.sliceCols=e.cols,i=h.default.getExtname(t.mapFileName),o=new Map,u.default.show(),a=t.sliceRows*t.sliceCols,c=0,p=0,f=function(e){var s,h,f;return r(this,function(g){switch(g.label){case 0:s=function(s){var h,f,g;return r(this,function(r){switch(r.label){case 0:return h=e+"_"+s+"."+i,(f=n.get(h))?((g=new FileReader).onload=function(){var n=new Image;n.src=g.result,n.onload=function(){p--;var i=new cc.Texture2D;i.initWithElement(n);var r=new cc.SpriteFrame(i);o.set(e+"_"+s,r),++c>=a&&(u.default.hide(),t.spriteFrameMap=o,m._args[0](t),m.close())}},g.readAsDataURL(f),++p>=5?[4,d.default.sleep(100)]:[3,2]):(u.default.hide(),l.default.show("\u5730\u56fe\u5207\u7247\u6587\u4ef6 ["+h+"] \u4e0d\u5b58\u5728"),[2,{value:void 0}]);case 1:r.sent(),r.label=2;case 2:return[2]}})},h=0,g.label=1;case 1:return h<t.sliceRows?[5,s(h)]:[3,4];case 2:if("object"==typeof(f=g.sent()))return[2,f];g.label=3;case 3:return h++,[3,1];case 4:return[2]}})},g=0,w.label=1;case 1:return g<t.sliceCols?[5,f(g)]:[3,4];case 2:if("object"==typeof(y=w.sent()))return[2,y.value];w.label=3;case 3:return g++,[3,1];case 4:return[2]}})})},s.readAsText(this.fileSlice)}else l.default.show("slices.json \u6587\u4ef6\u4e0d\u5b58\u5728")},e}(c.default);n.default=g,cc._RF.pop()},{"../../framework/scripts/AppConstants":"AppConstants","../../framework/scripts/view/PanelBase":"PanelBase","../core/Tip":"Tip","../core/Wait":"Wait","../map/MapArg":"MapArg","../util/FileUtil":"FileUtil","../util/HtmlUtil":"HtmlUtil","../util/TimeUtil":"TimeUtil"}],PanelMgr:[function(t,e,n){"use strict";cc._RF.push(e,"b4419ROtQdNkqhIDK5+VE9d","PanelMgr");var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,a){function r(t){try{c(i.next(t))}catch(e){a(e)}}function s(t){try{c(i.throw(t))}catch(e){a(e)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(r,s)}c((i=i.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,i,o,a,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(t){return function(e){return c([t,e])}}function c(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=2&a[0]?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,i=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(o=(o=r.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(s){a=[6,s],i=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../AppConstants"),r=t("../AppUtil"),s=t("../manager/EventMgr"),c=t("../manager/ResMgr"),l=t("./LayerMgr"),u=t("./TopBlock"),p=function(){function t(){}return t.init=function(){this._panels.clear(),this._maskPrefab&&this._maskPrefab.isValid||(this._maskPrefab=r.default.newSpriteNode(this._maskName),this._maskPrefab.color=cc.Color.BLACK,this._maskPrefab.opacity=0)},t.show=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return i(this,void 0,void 0,function(){var n,i,s,p,h,f,d;return o(this,function(o){switch(o.label){case 0:return u.default.show(),n=new t,i=n.getClassName(),(s=this._panels.get(i))?[3,4]:((s=n).panelName=i,p=void 0,"null"!=s.bundleName?[3,1]:(f=cc.find(s.skinPath,cc.Canvas.instance.node))?(p=cc.instantiate(f),[3,3]):(u.default.hide(),console.error("PanelMgr.show cc.find \u627e\u4e0d\u5230["+i+"]\u9762\u677f\u573a\u666f\u5bf9\u8c61:"+s.skinPath),[2]));case 1:return[4,r.default.asyncWrap(c.default.load(s.bundleName,s.skinPath))];case 2:if(h=o.sent(),f=h[0],d=h[1])return u.default.hide(),console.error("PanelMgr.show load bundleName:"+s.bundleName+",skinPath:"+s.skinPath+",err:"+d),[2];p=cc.instantiate(f),o.label=3;case 3:return s.init(e),s.skin=p,s.initDone(),l.default.setLayer(s.skin,a.default.viewLayer.Panel),this.maskStyle(s),this._panels.set(i,s),[3,5];case 4:s.reset(e),l.default.setLayer(s.skin,a.default.viewLayer.Panel),o.label=5;case 5:return s.skin.active=!1,s.showing(),this.startShowPanel(s,s.panelShowStyle,!0),[2]}})})},t.isAlive=function(t){var e=r.default.getClassName(t);return this._panels.has(e)&&this._panels.get(e).skin.active},t.updateView=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i=r.default.getClassName(t);this.isAlive(t)?this._panels.get(i).updateView(e):console.error("PanelMgr.updateView [%s] \u66f4\u65b0 view \u5931\u8d25, \u672a\u6253\u5f00\u6216\u672a\u6fc0\u6d3b",i)},t.hide=function(t){if(this._panels.has(t)){var e=this._panels.get(t);e.skin.active?(u.default.show(),this.startShowPanel(e,e.panelShowStyle,!1)):console.error("PanelMgr.hide \u9762\u677f["+t+"]\u5df2\u9690\u85cf")}else console.error("PanelMgr.hide \u9762\u677f["+t+"]\u4e0d\u5b58\u5728")},t.hideAll=function(){var t=this;this._panels.forEach(function(e){e.skin.active&&t.destroy(e.panelName)}),s.default.emit(a.default.event.PanelHide)},t.destroy=function(t,e){if(void 0===e&&(e=!1),this._panels.has(t)){var n=this._panels.get(t);n.hiding(),n.skin.active=!1,n.hided(),!e&&n.cache||(this._panels.delete(t),n.destroy(),n=null)}else console.error("PanelMgr.destroy \u9762\u677f["+t+"]\u4e0d\u5b58\u5728")},t.maskStyle=function(t){var e=this,n=cc.instantiate(this._maskPrefab);t.skin.addChild(n,-1),r.default.setWidget(n,t.skin.parent),(t.panelMaskStyle&a.default.panelMaskStyle.NoThrough)>0&&n.addComponent(cc.BlockInputEvents),(t.panelMaskStyle&a.default.panelMaskStyle.Close)>0&&(n.getComponent(cc.BlockInputEvents)||n.addComponent(cc.BlockInputEvents),n.on(cc.Node.EventType.TOUCH_START,function(i){for(var o=i.getLocation(),a=0,r=t.skin.children;a<r.length;a++){var s=r[a];if(s!=n&&s.getBoundingBoxToWorld().contains(o))return}e.hide(t.panelName)}))},t.startShowPanel=function(t,e,n){switch(e){case a.default.panelShowStyle.Normal:this.showNormal(t,n);break;case a.default.panelShowStyle.CenterSmallToBig:this.showCenterScale(t,n);break;case a.default.panelShowStyle.LeftToCenter:this.showSideToCenter(t,cc.v3(-cc.winSize.width,0,0),n);break;case a.default.panelShowStyle.RightToCenter:this.showSideToCenter(t,cc.v3(cc.winSize.width,0,0),n);break;case a.default.panelShowStyle.UpToCenter:this.showSideToCenter(t,cc.v3(0,cc.winSize.height,0),n);break;case a.default.panelShowStyle.DownToCenter:this.showSideToCenter(t,cc.v3(0,-cc.winSize.height,0),n);break;case a.default.panelShowStyle.Custom:n&&!t.tweenShow?this.showNormal(t,n):n||t.tweenHide?this.showCustom(t,n):this.showNormal(t,n);break;default:console.error("PanelMgr.startShowPanel showStyle \u9519\u8bef:"+e)}},t.showNormal=function(t,e){this.showPanelBefore(t,e),e?(t.skin.active=!0,t.showed()):this.destroy(t.panelName),this.showPanelAfter(t,e)},t.showCenterScale=function(t,e){var n=this;this.showPanelBefore(t,e),e?(t.skin.scale=0,t.skin.active=!0,cc.tween(t.skin).to(t.duration,{scale:1},t.easingShow).call(function(){t.showed(),n.showPanelAfter(t,e)}).start()):cc.tween(t.skin).to(t.duration,{scale:0},t.easingHide).call(function(){n.destroy(t.panelName),n.showPanelAfter(t,e)}).start()},t.showSideToCenter=function(t,e,n){var i=this;this.showPanelBefore(t,n);var o=cc.Vec3.ZERO;n?(t.skin.setPosition(e),t.skin.active=!0,cc.tween(t.skin).to(t.duration,{position:o},t.easingShow).call(function(){t.showed(),i.showPanelAfter(t,n)}).start()):cc.tween(t.skin).to(t.duration,{position:e},t.easingHide).call(function(){i.destroy(t.panelName),i.showPanelAfter(t,n)}).start()},t.showCustom=function(t,e){var n=this;this.showPanelBefore(t,e),e?(t.skin.active=!0,t.tweenShow.call(function(){t.showed(),n.showPanelAfter(t,e)}).start()):t.tweenHide.call(function(){n.destroy(t.panelName),n.showPanelAfter(t,e)}).start()},t.showPanelBefore=function(t,e){!e&&(t.panelMaskStyle&a.default.panelMaskStyle.Black)>0&&(t.skin.getChildByName(this._maskName).opacity=0)},t.showPanelAfter=function(t,e){var n=this,i=t.skin.getChildByName(this._maskName);i.setPosition(cc.Vec2.ZERO),e&&(t.panelMaskStyle&a.default.panelMaskStyle.Black)>0?t.blackMaskDuration<=0?(i.opacity=125,this.showPanelAfter2(e)):cc.tween(i).to(t.blackMaskDuration,{opacity:125}).call(function(){return n.showPanelAfter2(e)}).start():this.showPanelAfter2(e)},t.showPanelAfter2=function(t){if(u.default.hide(),t)s.default.emit(a.default.event.PanelShow);else{var e=!0;this._panels.forEach(function(t){t.skin.active&&(e=!1)}),e&&s.default.emit(a.default.event.PanelHide)}},t._panels=new Map,t._maskName="_mask",t}();n.default=p,cc._RF.pop()},{"../AppConstants":"AppConstants","../AppUtil":"AppUtil","../manager/EventMgr":"EventMgr","../manager/ResMgr":"ResMgr","./LayerMgr":"LayerMgr","./TopBlock":"TopBlock"}],PanelSave:[function(t,e,n){"use strict";cc._RF.push(e,"024ddl27+VJHr028wjne7Ce","PanelSave");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var a=t("../../framework/scripts/AppConstants"),r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bundleName="null",e.skinPath="_panels/PanelSave",e.panelMaskStyle=a.default.panelMaskStyle.NoThrough|a.default.panelMaskStyle.Black,e}return o(e,t),e.prototype.onButtonClick=function(t){this._args[0]("BtnSave"==t.name),this.close()},e}(t("../../framework/scripts/view/PanelBase").default);n.default=r,cc._RF.pop()},{"../../framework/scripts/AppConstants":"AppConstants","../../framework/scripts/view/PanelBase":"PanelBase"}],Player:[function(t,e,n){"use strict";cc._RF.push(e,"e8cb9LTCmtGtrn/ljahz9IU","Player");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,c=r.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.animation=null,e}return o(e,t),e.prototype.start=function(){this.animation.play("Idle")},e.prototype.move=function(t){t.shift(),t.length<=0||(this._tween||this.animation.play("Move"),this.reset(),this._moveStep=0,this._movePaths=t,this.tweenMove())},e.prototype.tweenMove=function(){var t=this;if(this._moveStep>=this._movePaths.length)this.stopMove();else{var e=this.node.getPosition(),n=this._movePaths[this._moveStep],i=n.sub(e).len()/200;this.changeAngle(n),this._tween=cc.tween(this.node).to(i,{position:cc.v3(n.x,n.y)}).call(function(){t._moveStep++,t.tweenMove()}).start()}},e.prototype.stopMove=function(){this.reset(),this.animation.play("Idle")},e.prototype.reset=function(){this._moveStep=0,this._movePaths=[],this._tween&&(this._tween.stop(),this._tween=null)},e.prototype.changeAngle=function(t){var e=t.sub(this.node.getPosition()).normalize(),n=cc.misc.radiansToDegrees(cc.v2(1,0).signAngle(e))+90;this.node.eulerAngles=cc.v3(0,n,0)},a([c(cc.SkeletonAnimation)],e.prototype,"animation",void 0),a([s],e)}(cc.Component);n.default=l,cc._RF.pop()},{}],PolygonButtonComp:[function(t,e,n){"use strict";cc._RF.push(e,"6dc27YyB+tGMatfcsmPg7A1","PolygonButtonComp");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,c=r.menu,l=r.requireComponent,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._isTouchStart=!1,e._isBig=!1,e}return o(e,t),e.prototype.onLoad=function(){var t=this;this.node.on(cc.Node.EventType.TOUCH_START,function(e){return t.onTouchStart(e)}),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(e){return t.onTouchMove(e)}),this.node.on(cc.Node.EventType.TOUCH_END,function(e){return t.onTouchEnd(e)}),this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(){return t.onTouchCancel()})},e.prototype.setClickCallback=function(t){this.cb=t},e.prototype.onTouchStart=function(t){this.checkClick(t.getLocation())&&(this._isTouchStart=!0,this._isBig=!0,cc.tween(this.node).to(.1,{scale:1.1}).start())},e.prototype.onTouchMove=function(t){if(this._isTouchStart){var e=this.checkClick(t.getLocation());e&&!this._isBig?(this._isBig=!0,cc.tween(this.node).to(.1,{scale:1.1}).start()):!e&&this._isBig&&(this._isBig=!1,cc.tween(this.node).to(.1,{scale:1}).start())}},e.prototype.onTouchEnd=function(t){if(this._isTouchStart){this._isTouchStart=!1;var e=this.checkClick(t.getLocation());(e||this._isBig)&&(e&&this.cb&&this.cb(this.node),this._isBig&&(this._isBig=!1,cc.tween(this.node).to(.1,{scale:1}).start()))}},e.prototype.onTouchCancel=function(){this._isTouchStart&&(this._isTouchStart=!1,this._isBig&&(this._isBig=!1,cc.tween(this.node).to(.1,{scale:1}).start()))},e.prototype.checkClick=function(t){var e=this.node.convertToNodeSpaceAR(t),n=this.node.getComponent(cc.PolygonCollider).points;return cc.Intersection.pointInPolygon(e,n)},a([s,l(cc.PolygonCollider),c("UI/PolygonButtonComp")],e)}(cc.Component);n.default=u,cc._RF.pop()},{}],ResMgr:[function(t,e,n){"use strict";cc._RF.push(e,"89230V/kXhG1IFci6O39CVw","ResMgr"),Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){}return t.load=function(t,e){return t?this.loadBundleRes(t,e):this.loadRes(e)},t.loadRemote=function(t){return new Promise(function(e,n){cc.assetManager.loadRemote(t,function(t,i){t?n(t):e(i)})})},t.loadBundle=function(t){return new Promise(function(e,n){var i=cc.assetManager.getBundle(t);i?e(i):cc.assetManager.loadBundle(t,function(t,i){t?n(t):e(i)})})},t.loadBundleRes=function(t,e,n){var i=this;return new Promise(function(o,a){i.loadBundle(t).then(function(t){t.load(e,n,function(t,e){t?a(t):o(e)})}).catch(function(t){a(t)})})},t.loadBundleResDir=function(t,e,n){var i=this;return new Promise(function(o,a){i.loadBundle(t).then(function(t){t.loadDir(e,n,function(t,e){t?a(t):o(e)})}).catch(function(t){a(t)})})},t.loadBundleResArray=function(t,e,n){var i=this;return new Promise(function(o,a){i.loadBundle(t).then(function(t){t.load(e,n,function(t,e){t?a(t):o(e)})}).catch(function(t){a(t)})})},t.loadRes=function(t,e){return new Promise(function(n,i){cc.resources.load(t,e,function(t,e){t?i(t):n(e)})})},t.loadResDir=function(t,e){return new Promise(function(n,i){cc.resources.loadDir(t,e,function(t,e){t?i(t):n(e)})})},t.loadResArray=function(t,e){return new Promise(function(n,i){cc.resources.load(t,e,function(t,e){t?i(t):n(e)})})},t}();n.default=i,cc._RF.pop()},{}],Runner:[function(t,e,n){"use strict";cc._RF.push(e,"3a9f9VfxXtLaKeHfCkGZ1Jd","Runner");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var r=t("../../framework/scripts/AppUtil"),s=t("../AStar"),c=t("../GameConstants"),l=t("../actor/Player"),u=t("../map/MapInfo"),p=t("../util/MapUtil"),h=cc._decorator.ccclass,f=function(t,e){this.prefab=t,this.parent=e},d=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.onLoad=function(){this.init()},e.prototype.update=function(t){this.cameraFollowPlayer(t)},e.prototype.init=function(){this.mainCamera=this.node.getChildByName("Main Camera").getComponent(cc.Camera),this.initPlayer(),this.cameraFollowPlayer(),this.initMap(),this.node.getChildByName("ui").getChildByName("btnBack").on("click",function(){return cc.director.loadScene("editor")}),this.astar=new s.default(u.default.rows,u.default.cols,!0,u.default.mapData.data)},e.prototype.initPlayer=function(){this.player=this.node.getChildByName("map").getChildByName("actor").getChildByName("player").getComponent(l.default);for(var t=0;t<u.default.cols;t++)for(var e=0;e<u.default.rows;e++)if(0!=u.default.mapData.data[t][e])return void this.player.node.setPosition(p.default.gridToPos(e,t));this.player.node.setPosition(cc.winSize.width/2,cc.winSize.height/2)},e.prototype.initMap=function(){var t=this,e=this.node.getChildByName("map").getChildByName("bg"),n=new cc.Node;n.parent=e,n.setAnchorPoint(cc.Vec2.ZERO),u.default.isBigMap?this.loadSliceMap(n):n.addComponent(cc.Sprite).spriteFrame=u.default.mapSpriteFrame,this.initMapGrid(),this.initDrawPath(),n.on(cc.Node.EventType.TOUCH_START,function(e){var i=n.convertToNodeSpaceAR(t.mainCamera.getScreenToWorldPoint(e.getLocation())),o=t.astar.findPath(p.default.pixelToGrid(t.player.node.getPosition()),p.default.pixelToGrid(cc.v2(i)));if(!(o.length<=0)){for(var a=[],r=0,s=o;r<s.length;r++){var c=s[r];a.push(p.default.gridToPos(c.x,c.y))}t.mapDrawPath(a),t.player.move(a)}})},e.prototype.initMapGrid=function(){this.nodeDebug=this.node.getChildByName("map").getChildByName("debug");var t=new cc.Node;t.parent=this.nodeDebug,t.setAnchorPoint(cc.Vec2.ZERO);var e=t.addComponent(cc.Graphics);e.strokeColor=cc.Color.RED;for(var n=1;n<u.default.rows;n++)this.mapDrawCol(n,e);for(n=1;n<u.default.cols;n++)this.mapDrawRow(n,e);this.mapDrawGrid(u.default.mapData)},e.prototype.initDrawPath=function(){this.nodePath=new cc.Node,this.nodePath.parent=this.nodeDebug,this.nodePath.setAnchorPoint(cc.Vec2.ZERO),this.prefabPath=r.default.newSpriteNode(),this.prefabPath.setContentSize(u.default.gridWidth-2,u.default.gridHeight-2),this.prefabPath.color=cc.Color.GREEN,this.prefabPath.active=!1},e.prototype.mapDrawRow=function(t,e){e.moveTo(0,t*u.default.gridHeight),e.lineTo(u.default.width,t*u.default.gridHeight),e.stroke()},e.prototype.mapDrawCol=function(t,e){e.moveTo(t*u.default.gridWidth,0),e.lineTo(t*u.default.gridWidth,u.default.height),e.stroke()},e.prototype.mapDrawGrid=function(t){for(var e,n=new Map,i=0;i<c.default.mapDrawTypes.length;i++){var o=i+1,a=c.default.mapDrawTypes[i],s=o.toString(),l=a[1],h=r.default.newSpriteNode(s);h.setContentSize(u.default.gridWidth-2,u.default.gridHeight-2),h.color=(new cc.Color).fromHEX(l),h.opacity=Number(null!==(e=a[2])&&void 0!==e?e:"255");var d=new cc.Node;d.parent=this.nodeDebug,d.setAnchorPoint(cc.Vec2.ZERO),n.set(o,new f(h,d))}for(var g=0;g<t.cols;g++)for(var y=0;y<t.rows;y++){o=t.data[g][y];var m=n.get(o);if(m){var w=cc.instantiate(m.prefab);w.name=""+o,w.parent=m.parent,w.setPosition(p.default.gridToPos(y,g))}}},e.prototype.mapDrawPath=function(t){this.nodePath.destroyAllChildren();for(var e=0,n=t;e<n.length;e++){var i=n[e],o=cc.instantiate(this.prefabPath);o.parent=this.nodePath,o.setPosition(i),o.active=!0}},e.prototype.loadSliceMap=function(t){t.width=u.default.width,t.height=u.default.height;for(var e=0;e<u.default.sliceCols;e++)for(var n=0;n<u.default.sliceRows;n++){var i=e+"_"+n,o=u.default.mapSpriteFrameMap.get(i),a=new cc.Node;a.addComponent(cc.Sprite).spriteFrame=o,a.parent=t,a.setPosition(p.default.sliceGridToPos(n,e))}},e.prototype.cameraFollowPlayer=function(t){void 0===t&&(t=-1);var e=this.player.node.position.sub(cc.v3(cc.winSize.width/2,cc.winSize.height/2));e.x=cc.misc.clampf(0,e.x,u.default.width-cc.winSize.width),e.y=cc.misc.clampf(0,e.y,u.default.height-cc.winSize.height),t>0&&this.mainCamera.node.position.lerp(e,5*t,e),this.mainCamera.node.position=e},a([h],e)}(cc.Component);n.default=d,cc._RF.pop()},{"../../framework/scripts/AppUtil":"AppUtil","../AStar":"AStar","../GameConstants":"GameConstants","../actor/Player":"Player","../map/MapInfo":"MapInfo","../util/MapUtil":"MapUtil"}],Singleton:[function(t,e,n){"use strict";cc._RF.push(e,"92f27txO41GrohHVRGGnVGw","Singleton"),Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){}return t.getInstance=function(){return this._instance||(this._instance=new this),this._instance},t}();n.default=i,cc._RF.pop()},{}],SpriteFrameComp:[function(t,e,n){"use strict";cc._RF.push(e,"526057UeMJCa70JbyCcFYjQ","SpriteFrameComp");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__decorate||function(t,e,n,i){var o,a=arguments.length,r=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(r=(a<3?o(r):a>3?o(e,n,r):o(e,n))||r);return a>3&&r&&Object.defineProperty(e,n,r),r};Object.defineProperty(n,"__esModule",{value:!0});var r=cc._decorator,s=r.ccclass,c=r.property,l=r.menu,u=r.requireComponent,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.frames=[],e}return o(e,t),e.prototype.setFrame=function(t){var e=this.frames.find(function(e){return e.name==t});e&&(this.node.getComponent(cc.Sprite).spriteFrame=e)},e.prototype.setFrameByIndex=function(t){t<0||t>=this.frames.length||(this.node.getComponent(cc.Sprite).spriteFrame=this.frames[t])},a([c([cc.SpriteFrame])],e.prototype,"frames",void 0),a([s,u(cc.Sprite),l("UI/SpriteFrameComp")],e)}(cc.Component);n.default=p,cc._RF.pop()},{}],StateMachine:[function(t,e,n){"use strict";cc._RF.push(e,"3ddceKu6GRKMas2SE38t4wj","StateMachine"),Object.defineProperty(n,"__esModule",{value:!0});var i=t("./State"),o=function(){function t(t){this._stateMap=new Map,this._owner=t}return t.prototype.register=function(t){this._owner==t.owner?this._stateMap.set(t.getStateKey(),t):console.error("StateMachine.register owner \u4e0d\u4e00\u81f4")},t.prototype.enter=function(t,e){var n=this._stateMap.get(t);n?this._currentState?this._currentState.getStateKey()==t?n.onReEnter(e):(this._currentState.onExit(n.getStateKey()),n.onEnter(e,this._currentState.getStateKey()),this._currentState=n):(n.onEnter(e),this._currentState=n):console.error("StateMachine.enter \u4e0d\u5b58\u5728 state:"+t)},t.prototype.update=function(t){this._currentState&&this._currentState.onUpdate(t)},t.prototype.getCurrentStateKey=function(){return this._currentState?this._currentState.getStateKey():i.default.invalidState},t.prototype.clear=function(){this._currentState&&this._currentState.onExit(i.default.invalidState),this._owner=null,this._stateMap.clear(),this._stateMap=null,this._currentState=null},t}();n.default=o,cc._RF.pop()},{"./State":"State"}],State:[function(t,e,n){"use strict";cc._RF.push(e,"1effc+VANxI/azQut2/GYIp","State"),Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t){this._owner=t}return Object.defineProperty(t.prototype,"owner",{get:function(){return this._owner},enumerable:!1,configurable:!0}),t.prototype.onEnter=function(){},t.prototype.onReEnter=function(){},t.prototype.onUpdate=function(){},t.prototype.onExit=function(){},t.prototype.getStateKey=function(){return t.invalidState},t.invalidState="invalid",t}();n.default=i,cc._RF.pop()},{}],TimeUtil:[function(t,e,n){"use strict";cc._RF.push(e,"c1592UdQB5EoJG3wSEQLZ0t","TimeUtil");var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,a){function r(t){try{c(i.next(t))}catch(e){a(e)}}function s(t){try{c(i.throw(t))}catch(e){a(e)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(r,s)}c((i=i.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,i,o,a,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(t){return function(e){return c([t,e])}}function c(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=2&a[0]?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,i=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(o=(o=r.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(s){a=[6,s],i=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(){}return t.sleep=function(t){return i(this,void 0,void 0,function(){return o(this,function(){return[2,new Promise(function(e){return setTimeout(e,t)})]})})},t}();n.default=a,cc._RF.pop()},{}],TimerMgr:[function(t,e,n){"use strict";cc._RF.push(e,"8b49bWwkV5LwpPb15jo4l+U","TimerMgr");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var a=function(t){function e(){var e=t.call(this)||this;return e._timers=[],cc.director.on(cc.Director.EVENT_BEFORE_UPDATE,e.update,e),e}return o(e,t),Object.defineProperty(e,"inst",{get:function(){return t.getInstance.call(this)},enumerable:!1,configurable:!0}),e.prototype.add=function(t,e,n,i,o){void 0===i&&(i=1),null!=e?this.exist(e,n,o)?cc.error("TimerMgr.add \u5b9a\u65f6\u5668\u5df2\u5b58\u5728"):this._timers.push({tick:0,interval:t,cb:e,ctx:n,repeat:i,key:o}):cc.error("TimerMgr.add \u53c2\u6570\u9519\u8bef")},e.prototype.del=function(t,e,n){var i=this._timers.findIndex(function(i){return t===i.cb&&i.ctx===e&&i.key===n});i>=0&&this._timers.splice(i,1)},e.prototype.clear=function(t){if(t)for(var e=this._timers.length-1;e>=0;e--)this._timers[e].ctx==t&&this._timers.splice(e,1)},e.prototype.update=function(){for(var t=cc.director.getDeltaTime(),e=this._timers.length-1;e>=0;e--){var n=this._timers[e];n.tick+=1e3*t,n.tick<n.interval||(n.tick-=n.interval,n.repeat<=0?0==n.interval?n.cb.call(n.ctx,t):n.cb.call(n.ctx,n.key):(n.repeat--,0==n.repeat&&this._timers.splice(e,1),n.cb.call(n.ctx,n.key)))}},e.prototype.exist=function(t,e,n){return this._timers.findIndex(function(i){return t===i.cb&&i.ctx===e&&i.key===n})>=0},e}(t("../base/Singleton").default);n.default=a,cc._RF.pop()},{"../base/Singleton":"Singleton"}],Tip:[function(t,e,n){"use strict";cc._RF.push(e,"1c125YPpJtKI44F3Tp++H8H","Tip");var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,a){function r(t){try{c(i.next(t))}catch(e){a(e)}}function s(t){try{c(i.throw(t))}catch(e){a(e)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(r,s)}c((i=i.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,i,o,a,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(t){return function(e){return c([t,e])}}function c(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=2&a[0]?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,i=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(o=(o=r.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(s){a=[6,s],i=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../../framework/scripts/AppConstants"),r=t("../../framework/scripts/AppUtil"),s=t("../../framework/scripts/manager/ResMgr"),c=t("../../framework/scripts/view/LayerMgr"),l=function(){function t(){}return t.init=function(){return i(this,void 0,void 0,function(){var t,e,n;return o(this,function(i){switch(i.label){case 0:return this._prefab?[2,!0]:[4,r.default.asyncWrap(s.default.loadRes("core/Tip"))];case 1:return t=i.sent(),e=t[0],(n=t[1])?(console.error("Tip.init \u627e\u4e0d\u5230\u8d44\u6e90 [core/Tip] error:"+n),[2,!1]):(this._prefab=e,[2,!0])}})})},t.show=function(t){this._view&&this._view.isValid||(this._view=cc.instantiate(this._prefab),this._view.opacity=0,c.default.setLayer(this._view,a.default.viewLayer.Top)),this._view.getChildByName("lblTip").getComponent(cc.Label).string=t,this._view.y=0,this._view.stopAllActions(),cc.tween(this._view).show().to(.2,{opacity:255}).delay(2).to(.5,{opacity:0,y:100}).hide().start()},t}();n.default=l,cc._RF.pop()},{"../../framework/scripts/AppConstants":"AppConstants","../../framework/scripts/AppUtil":"AppUtil","../../framework/scripts/manager/ResMgr":"ResMgr","../../framework/scripts/view/LayerMgr":"LayerMgr"}],TopBlock:[function(t,e,n){"use strict";cc._RF.push(e,"76626yk2dpI/ozEFXRSaML4","TopBlock"),Object.defineProperty(n,"__esModule",{value:!0});var i=t("../AppConstants"),o=t("../AppUtil"),a=t("./LayerMgr"),r=function(){function t(){}return t.show=function(){this.ensure(),a.default.setLayer(this._view,i.default.viewLayer.Top),this._view.active=!0},t.hide=function(){this._view&&this._view.isValid&&(this._view.active=!1)},t.ensure=function(){this._view&&this._view.isValid||(this._view=new cc.Node("TopBlock"),this._view.opacity=0,o.default.setWidget(this._view),this._view.addComponent(cc.BlockInputEvents))},t}();n.default=r,cc._RF.pop()},{"../AppConstants":"AppConstants","../AppUtil":"AppUtil","./LayerMgr":"LayerMgr"}],UIBase:[function(t,e,n){"use strict";cc._RF.push(e,"cca73ZQ1PFGPrGQ/8nWli4m","UIBase");var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(n,"__esModule",{value:!0});var a=t("../AppConstants"),r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.uiShowStyle=a.default.uiShowStyle.Normal,e.duration=.5,e}return o(e,t),e}(t("./ViewBase").default);n.default=r,cc._RF.pop()},{"../AppConstants":"AppConstants","./ViewBase":"ViewBase"}],UIMgr:[function(t,e,n){"use strict";cc._RF.push(e,"ff5eeVEAy5IGYgbR1VUKaui","UIMgr");var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,a){function r(t){try{c(i.next(t))}catch(e){a(e)}}function s(t){try{c(i.throw(t))}catch(e){a(e)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(r,s)}c((i=i.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,i,o,a,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(t){return function(e){return c([t,e])}}function c(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=2&a[0]?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,i=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(o=(o=r.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(s){a=[6,s],i=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var a=t("./LayerMgr"),r=t("../AppUtil"),s=t("../AppConstants"),c=t("../manager/ResMgr"),l=t("./TopBlock"),u=function(t,e){this.uiCls=t,this.args=e},p=function(){function t(){}return t.init=function(t){this._uis.clear(),this._uiMain=t,this._uiOpens=[]},t.open=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i=new t,o=i.getClassName();this._current&&this._current.uiName==o?console.error("UIMgr.open \u5df2\u5728\u5f53\u524dUI:"+o):(this._isOpen=!0,this._openData=new u(t,e),this.show(i,e))},t.back=function(){if(this._uiOpens.length<2)console.error("UIMgr.back \u6570\u636e\u9519\u8bef");else{this._isOpen=!1;var t=this._uiOpens[this._uiOpens.length-2];this.show(new t.uiCls,t.args)}},t.isAlive=function(t){var e=r.default.getClassName(t);return null!=this._current&&e==this._current.uiName},t.updateView=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return!!this.isAlive(t)&&(this._current.updateView(e),!0)},t.show=function(t,e){return i(this,void 0,void 0,function(){var n,i,a,s,u,p;return o(this,function(o){switch(o.label){case 0:return l.default.show(),n=t.getClassName(),(i=this._uis.get(n))?[3,4]:((i=t).uiName=n,a=void 0,"null"!=i.bundleName?[3,1]:(u=cc.find(i.skinPath,cc.Canvas.instance.node))?(a=cc.instantiate(u),u.active=!1,[3,3]):(l.default.hide(),console.error("UIMgr.show cc.find \u627e\u4e0d\u5230["+n+"]\u9762\u677f\u573a\u666f\u5bf9\u8c61:"+i.skinPath),[2]));case 1:return[4,r.default.asyncWrap(c.default.load(i.bundleName,i.skinPath))];case 2:if(s=o.sent(),u=s[0],p=s[1])return l.default.hide(),console.error("UIMgr.show loadRes skinPath:"+i.skinPath+" err:"+p),[2];a=cc.instantiate(u),o.label=3;case 3:return i.init(e),i.skin=a,i.initDone(),[3,5];case 4:i.reset(e),o.label=5;case 5:return this.startShowUI(i),[2]}})})},t.startShowUI=function(t){if(t.showing(),r.default.setWidget(t.skin),a.default.setLayer(t.skin,s.default.viewLayer.UI),t.uiShowStyle==s.default.uiShowStyle.Normal||!this._current||t.duration<=0)this.showNormal(t);else switch(t.uiShowStyle){case s.default.uiShowStyle.FadeIn:this.showFadeIn(t);break;default:console.error("UIMgr.startShowUI uiShowStyle \u9519\u8bef:"+t.uiShowStyle)}},t.hideLast=function(t){var e=this,n=this._current;n&&(this._current=null,n.hiding(),t?cc.tween(n.skin).to(t,{opacity:0}).call(function(){return e.hideUI(n)}).start():this.hideUI(n))},t.hideUI=function(t){t.skin.active=!1,t.hided(),t.cache||(this._uis.delete(t.uiName),t.destroy())},t.showUIAfter=function(t){l.default.hide(),this._current=t,this._uis.has(t.uiName)||this._uis.set(t.uiName,t),this._isOpen?(this._uiMain==t.uiName&&(this._uiOpens=[]),this._uiOpens.push(this._openData)):this._isOpen||this._uiOpens.splice(this._uiOpens.length-1,1)},t.showNormal=function(t){t.skin.opacity=255,t.skin.active=!0,t.showed(),this.hideLast(),this.showUIAfter(t)},t.showFadeIn=function(t){var e=this;t.skin.opacity=0,t.skin.active=!0,this.hideLast(t.duration),cc.tween(t.skin).to(t.duration,{opacity:255}).call(function(){t.showed(),e.showUIAfter(t)}).start()},t._uis=new Map,t._uiOpens=[],t}();n.default=p,cc._RF.pop()},{"../AppConstants":"AppConstants","../AppUtil":"AppUtil","../manager/ResMgr":"ResMgr","./LayerMgr":"LayerMgr","./TopBlock":"TopBlock"}],ViewBase:[function(t,e,n){"use strict";cc._RF.push(e,"83a87dhoAZFa6AlfPqlx/iu","ViewBase"),Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){this.cache=!1,this._args=[]}return t.prototype.getClassName=function(){return this.skinPath.split("/").slice(-1)[0]},t.prototype.init=function(t){this._args=t,this.onInit()},t.prototype.initDone=function(){for(var t=this,e=function(e){if(!e.node.name.startsWith("Btn"))return"continue";e.node.on("click",function(){t.onButtonClick(e.node)})},n=0,i=this.skin.getComponentsInChildren(cc.Button);n<i.length;n++)e(i[n]);this.onInitDone()},t.prototype.reset=function(t){this._args=t,this.onReset()},t.prototype.showing=function(){this.onShowing()},t.prototype.showed=function(){this.onShowed()},t.prototype.updateView=function(t){this.onUpdateView(t)},t.prototype.hiding=function(){this.onHiding()},t.prototype.hided=function(){this.onHided()},t.prototype.destroy=function(){this.onDestroy(),this.skin.destroy()},t.prototype.onInit=function(){},t.prototype.onInitDone=function(){},t.prototype.onReset=function(){},t.prototype.onButtonClick=function(){},t.prototype.onShowing=function(){},t.prototype.onShowed=function(){},t.prototype.onUpdateView=function(){},t.prototype.onHiding=function(){},t.prototype.onHided=function(){},t.prototype.onDestroy=function(){},t}();n.default=i,cc._RF.pop()},{}],Wait:[function(t,e,n){"use strict";cc._RF.push(e,"a6877LTj0lNVLWlB+rUp/gP","Wait");var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,a){function r(t){try{c(i.next(t))}catch(e){a(e)}}function s(t){try{c(i.throw(t))}catch(e){a(e)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(r,s)}c((i=i.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,i,o,a,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(t){return function(e){return c([t,e])}}function c(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=2&a[0]?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,i=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(o=(o=r.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(s){a=[6,s],i=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(n,"__esModule",{value:!0});var a=t("../../framework/scripts/AppConstants"),r=t("../../framework/scripts/AppUtil"),s=t("../../framework/scripts/manager/ResMgr"),c=t("../../framework/scripts/view/LayerMgr"),l=function(){function t(){}return t.init=function(){return i(this,void 0,void 0,function(){var t,e,n;return o(this,function(i){switch(i.label){case 0:return this._prefab?[2,!0]:[4,r.default.asyncWrap(s.default.loadRes("core/Wait"))];case 1:return t=i.sent(),e=t[0],(n=t[1])?(console.error("Wait.init \u627e\u4e0d\u5230\u8d44\u6e90 [core/Wait] error:"+n),[2,!1]):(this._prefab=e,[2,!0])}})})},t.show=function(){this.action(!0)},t.hide=function(){this.action(!1)},t.action=function(t){if(!this._view||!this._view.isValid){this._view=cc.instantiate(this._prefab),r.default.setWidget(this._view),this._view.addComponent(cc.BlockInputEvents);var e=this._view.getChildByName("wait");cc.tween(e).repeatForever(cc.tween().to(.75,{angle:-360}).call(function(){return e.angle=0})).start()}c.default.setLayer(this._view,a.default.viewLayer.Top),this._view.active=t},t}();n.default=l,cc._RF.pop()},{"../../framework/scripts/AppConstants":"AppConstants","../../framework/scripts/AppUtil":"AppUtil","../../framework/scripts/manager/ResMgr":"ResMgr","../../framework/scripts/view/LayerMgr":"LayerMgr"}]},{},["App","AppConstants","AppUtil","Singleton","MaskProgressComp","PolygonButtonComp","SpriteFrameComp","AudioMgr","EventMgr","HttpMgr","ResMgr","TimerMgr","State","StateMachine","LayerMgr","PanelBase","PanelMgr","TopBlock","UIBase","UIMgr","ViewBase","AStar","GameConstants","Player","Core","Tip","Wait","MapAction","MapArg","MapData","MapInfo","Editor","Runner","FileUtil","HtmlUtil","MapUtil","TimeUtil","PanelChoiceDraw","PanelMapNew","PanelMapOpen","PanelSave"]);